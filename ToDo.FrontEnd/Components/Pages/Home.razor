@page "/"
@inject TasksClient Client
@rendermode InteractiveServer

<div class="row px-4 justify-content-center">
  <div class="px-3 col-md-6 center">
  <PageTitle>Todo List</PageTitle>
  <button @onclick="sortTasks" class="btn bg-primary text-white mb-1">@(reverseByPriority ? "Low to High Priority" : "High to Low Priority")</button>
  <table class="table table-bordered table-dark">
    <thead class="thead-dark">
      <tr>
        <th scope="col" class="bg-primary text-center align-middle">Task ID</th>
        <th scope="col" class="bg-primary text-center align-middle">Title</th>
        <th scope="col" class="bg-primary text-center align-middle">Description</th>
        <th scope="col" class="bg-primary text-center align-middle">Priority</th>
        <th scope="col" class="bg-primary text-center align-middle">Created At</th>
        <th scope="col" class="bg-primary text-center align-middle">Actions</th>
      </tr>
    </thead>
    <tbody>
      @if(tasks is null) {
        <p>Loading...</p>
      } else {
        @foreach (var task in tasks)
        {
          <TaskView
            task="@task"
            DeleteTask = "HandleDeleteTask"
          />
        }
      }
    </tbody>
  </table>
  </div>
</div>

@code {
    private List<Models.Task>? tasks;
    private bool reverseByPriority = false;
    private void sortTasks() {
      reverseByPriority = !reverseByPriority;
      tasks = Client.GetTasksByPriority(reverseByPriority);
    }

    protected override void OnInitialized()
    {
        base.OnInitialized();
        tasks = Client.GetTasksByPriority();
    }

    private async System.Threading.Tasks.Task HandleDeleteTask(int taskId) {
      await Client.DeleteTask(taskId);
      tasks = Client.GetTasksByPriority(reverseByPriority);
      StateHasChanged();
    }
}