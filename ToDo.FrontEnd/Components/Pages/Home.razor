@page "/"
@inject TasksClient Client
@rendermode InteractiveServer

<div class="d-flex justify-content-center">
  <div class="col-md-10 p-3">
  <PageTitle>Todo List</PageTitle>
  <table class="table table-bordered table-dark ">
    <thead class="thead-dark">
      <tr>
        <th scope="col" class="bg-primary text-center align-middle">Title</th>
        <th scope="col" class="bg-primary text-center align-middle">Description</th>
        <th scope="col" class="bg-primary text-center align-middle">Priority</th>
        <th scope="col" class="bg-primary text-center align-middle">Created</th>
        <th scope="col" class="bg-primary text-center align-middle">Actions</th>
      </tr>
    </thead>
    <tbody>
      @if(tasks is null) {
        <p>Loading...</p>
      } else {
        @foreach (var task in tasks)
        {
          <TaskView
            task="@task"
            DeleteTaskAsync = "HandleDeleteTaskAsync"
            CompleteTaskAsync = "() => HandleCompleteTaskAsync(task)"
          />
        }
      }
    </tbody>
  </table>
  </div>
</div>

@code {
    private Models.Task[] tasks;
    
    protected override async System.Threading.Tasks.Task OnInitializedAsync()
    {
        base.OnInitialized();
        tasks = await Client.GetTasksAsync();
    }
    private async System.Threading.Tasks.Task HandleCompleteTaskAsync(Models.Task taskToComplete) {
      await Client.CompleteTaskAsync(taskToComplete);
      tasks = await Client.GetTasksAsync();
    }
    private async System.Threading.Tasks.Task HandleDeleteTaskAsync(int taskId) {
      await Client.DeleteTaskAsync(taskId);
      tasks = await Client.GetTasksAsync();
    }
}